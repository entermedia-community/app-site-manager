			<div class="card card-block credit-card-box" >
                <div class="card-header display-table">
                    <div class="row display-tr">
                        <h3 class="card-title display-td">Card Details</h3>
                        <div class="display-td">                            
                            <img class="img-responsive pull-right" src="http://i76.imgup.net/accepted_c22e0.png">
                        </div>
                    </div>                    
                </div>
                <div class="card-body">
                   <form action="$apphome/project/donatefinish.html" method="post" id="payment-form">
                   How much are you donating?<input type="text" class="form-component" name="totalprice.value"/>
                   <input type="hidden" name="field" value="totalprice"/>
  <div class="form-row">
    <label for="card-element">
      Credit or debit card
    </label>
    <div id="card-element" style="width: 30em">
      <!-- a Stripe Element will be inserted here. -->
    </div>

    <!-- Used to display form errors -->
    <div id="card-errors" role="alert"></div>
  </div>

  ##<input type="submit" id="btnSubmit" class="submit" value="Submit Payment">
</form>
                </div>
            </div>


<script type="text/javascript">
  // This identifies your website in the createToken call below
 	

	  	// This identifies your website in the createToken call below
	  	  #if($mediaarchive.isCatalogSettingTrue("productionmode"))
	  		console.log('production');
	  		#set($publishkey = $mediaarchive.getCatalogSettingValue("stripe_publishable_key"))
	  	  	
	  	  	
	  	 #else
	  		#set($publishkey = $mediaarchive.getCatalogSettingValue("stripe_test_publishable_key"))
	  	  	 
	  	  		 
	  	 #end
	  	var stripe = Stripe("$publishkey");
	   	var elements = stripe.elements();


	  	
	  	var card = elements.create('card');

	 // Add an instance of the card Element into the `card-element` <div>
	 card.mount('#card-element');

	 // Handle real-time validation errors from the card Element.
	 card.addEventListener('change', function(event) {
	   var displayError = document.getElementById('card-errors');
	   if (event.error) {
	     displayError.textContent = event.error.message;
	   } else {
	     displayError.textContent = '';
	   }
	 });

	 var form = document.getElementById('payment-form');
	 form.addEventListener('submit', function(event) {
	   event.preventDefault();

	   stripe.createToken(card).then(function(result) {
	     if (result.error) {
	       // Inform the user if there was an error
	       var errorElement = document.getElementById('card-errors');
	       errorElement.textContent = result.error.message;
	     } else {
	       // Send the token to your server
	       stripeResponseHandler(result);
	     }
	   });
	 });
	  	
	 stripeResponseHandler = function( response){
		  var form = jQuery('#payment-form');

		 
		    var token = response.token;
		    // Insert the token into the form so it gets submitted to the server
		    form.append(jQuery('<input type="hidden" name="stripeToken" />').val(token.id));
		    // and submit
		   jQuery('#payment-form').submit();
		   // $form.get(0).submit();
		  
	  }
  
  
</script>

